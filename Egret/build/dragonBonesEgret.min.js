var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},dragonBones;!function(t){var e=function(e){function a(){e.call(this)}return __extends(a,e),a.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture=null)},a.prototype.generateTextureData=function(){return t.BaseObject.borrowObject(r)},a}(t.TextureAtlasData);t.EgretTextureAtlasData=e;var r=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture.dispose(),this.texture=null)},e}(t.TextureData);t.EgretTextureData=r}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function r(t,r,a,i){e.call(this,t,r,a,i)}return __extends(r,e),Object.defineProperty(r.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),r.START=t.EventObject.START,r.LOOP_COMPLETE=t.EventObject.LOOP_COMPLETE,r.COMPLETE=t.EventObject.COMPLETE,r.FADE_IN=t.EventObject.FADE_IN,r.FADE_IN_COMPLETE=t.EventObject.FADE_IN_COMPLETE,r.FADE_OUT=t.EventObject.FADE_OUT,r.FADE_OUT_COMPLETE=t.EventObject.FADE_OUT_COMPLETE,r.FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND_EVENT=t.EventObject.SOUND_EVENT,r.ANIMATION_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.BONE_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.MOVEMENT_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND=t.EventObject.SOUND_EVENT,r}(egret.Event);t.EgretEvent=e;var r=function(r){function a(){r.call(this),a._clock||(a._clock=new t.WorldClock,a._clock.time=.001*egret.getTimer(),egret.startTick(a._clockHandler,a))}return __extends(a,r),a._clockHandler=function(t){t*=.001;var e=t-a._clock.time;return a._clock.advanceTime(e),a._clock.time=t,!1},a.prototype._onClear=function(){this._armature=null,this._debugDrawer=null},a.prototype._dispatchEvent=function(t){var r=egret.Event.create(e,t.type);r.data=t,this.dispatchEvent(r),egret.Event.release(r)},a.prototype._debugDraw=function(){this._debugDrawer||(this._debugDrawer=new egret.Shape),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),e=0,r=t.length;e<r;++e){var a=t[e],i=Math.max(a.length,5),n=a.globalTransformMatrix.tx,o=a.globalTransformMatrix.ty,s=n+a.globalTransformMatrix.a*i,l=o+a.globalTransformMatrix.b*i;this._debugDrawer.graphics.lineStyle(1,a.ik?16711680:65280,.5),this._debugDrawer.graphics.moveTo(n,o),this._debugDrawer.graphics.lineTo(s,l)}},a.prototype.hasEvent=function(t){return this.hasEventListener(t)},a.prototype.addEvent=function(t,e,r){this.addEventListener(t,e,r)},a.prototype.removeEvent=function(t,e,r){this.removeEventListener(t,e,r)},a.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=null)},a.prototype.advanceTimeBySelf=function(t){t?a._clock.add(this._armature):a._clock.remove(this._armature)},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a._clock=null,a}(egret.DisplayObjectContainer);t.EgretArmatureDisplay=r;var a=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.Event=a;var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.AnimationEvent=i;var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.FrameEvent=n;var o=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.SoundEvent=o;var s=function(e){function r(r,a,i){void 0===i&&(i=1),e.call(this),this._onClear(),this.texture=r,t.ObjectDataParser.getInstance().parseTextureAtlasData(a,this,i)}return __extends(r,e),r.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},r}(t.EgretTextureAtlasData);t.EgretTextureAtlas=s;var l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(s);t.EgretSheetAtlas=l;var u=function(){function e(){}return e.getInstance=function(){return t.EventObject._soundEventManager},e}();t.SoundEventManager=u;var h=function(){function t(){}return t}();t.AnimationCacheManager=h}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretSlot]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},e.prototype._initDisplay=function(t){},e.prototype._disposeDisplay=function(t){},e.prototype._onUpdateDisplay=function(){this._rawDisplay||(this._rawDisplay=new egret.Bitmap),this._renderDisplay=this._display||this._rawDisplay},e.prototype._addDisplay=function(){var t=this._armature._display;t.addChild(this._renderDisplay)},e.prototype._replaceDisplay=function(t){var e=this._armature._display,r=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,r),e.removeChild(r)},e.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},e.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},e.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},e.prototype._updateColor=function(){if(1!=this._colorTransform.redMultiplier||1!=this._colorTransform.greenMultiplier||1!=this._colorTransform.blueMultiplier||0!=this._colorTransform.redOffset||0!=this._colorTransform.greenOffset||0!=this._colorTransform.blueOffset||0!=this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var t=this._colorFilter.matrix;t[0]=this._colorTransform.redMultiplier,t[6]=this._colorTransform.greenMultiplier,t[12]=this._colorTransform.blueMultiplier,t[18]=this._colorTransform.alphaMultiplier,t[4]=this._colorTransform.redOffset,t[9]=this._colorTransform.greenOffset,t[14]=this._colorTransform.blueOffset,t[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=t;var e=this._renderDisplay.filters;e||(e=[]),e.indexOf(this._colorFilter)<0&&e.push(this._colorFilter),this._renderDisplay.filters=e}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},e.prototype._updateFilters=function(){},e.prototype._updateFrame=function(){var t=this._renderDisplay;if(this._display&&this._displayIndex>=0){var e=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,r=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,a=r||e,i=a.texture;if(i){var n=i.parent.texture;!i.texture&&n&&(i.texture=new egret.Texture,i.texture._bitmapData=n._bitmapData,i.texture.$initData(i.region.x,i.region.y,Math.min(i.region.width,n.textureWidth-i.region.x),Math.min(i.region.height,n.textureHeight-i.region.y),0,0,Math.min(i.region.width,n.textureWidth-i.region.x),Math.min(i.region.height,n.textureHeight-i.region.y),n.textureWidth,n.textureHeight));var o=this._armature._replacedTexture||i.texture;if(this._meshData&&this._display==this._meshDisplay){var s=this._meshDisplay,l=s.$renderNode;this._meshData!=e.mesh&&e&&e!=a?(this._pivotX=e.transform.x-a.transform.x,this._pivotY=e.transform.y-a.transform.y):(this._pivotX=0,this._pivotY=0),l.uvs.length=0,l.vertices.length=0,l.indices.length=0;for(var u=0,h=this._meshData.vertices.length;u<h;++u)l.uvs[u]=this._meshData.uvs[u],l.vertices[u]=this._meshData.vertices[u];for(var u=0,h=this._meshData.vertexIndices.length;u<h;++u)l.indices[u]=this._meshData.vertexIndices[u];if(o&&s.$setBitmapData(o),s.$updateVertices(),s.$invalidateTransform(),this._meshData.skinned){var p=s.matrix;p.identity(),s.matrix=p}}else{var c=i.frame||i.region,_=c.width,d=c.height;i.rotated&&(_=c.height,d=c.width),this._pivotX=a.pivot.x,this._pivotY=a.pivot.y,a.isRelativePivot&&(this._pivotX=_*this._pivotX,this._pivotY=d*this._pivotY),i.frame&&(this._pivotX+=i.frame.x,this._pivotY+=i.frame.y),e&&e!=a&&(this._pivotX+=e.transform.x-a.transform.x,this._pivotY+=e.transform.y-a.transform.y),o&&t.$setBitmapData(o)}return void this._updateVisible()}}this._pivotX=0,this._pivotY=0,t.visible=!1,t.$setBitmapData(null),t.x=this.origin.x,t.y=this.origin.y},e.prototype._updateMesh=function(){var t=this._meshDisplay,e=t.$renderNode,r=this._ffdVertices.length>0;if(this._meshData.skinned){for(var a=0,i=0,n=this._meshData.vertices.length;a<n;a+=2){for(var o=a/2,s=this._meshData.boneIndices[o],l=this._meshData.boneVertices[o],u=this._meshData.weights[o],h=0,p=0,c=0,_=s.length;c<_;++c){var d=this._meshBones[s[c]],f=d.globalTransformMatrix,m=u[c],g=0,v=0;r?(g=l[2*c]+this._ffdVertices[i],v=l[2*c+1]+this._ffdVertices[i+1]):(g=l[2*c],v=l[2*c+1]),h+=(f.a*g+f.c*v+f.tx)*m,p+=(f.b*g+f.d*v+f.ty)*m,i+=2}e.vertices[a]=h,e.vertices[a+1]=p}t.$updateVertices(),t.$invalidateTransform()}else if(r){for(var y=this._meshData.vertices,a=0,n=this._meshData.vertices.length;a<n;a+=2){var h=y[a]+this._ffdVertices[a],p=y[a+1]+this._ffdVertices[a+1];e.vertices[a]=h,e.vertices[a+1]=p}t.$updateVertices(),t.$invalidateTransform()}},e.prototype._updateTransform=function(){if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled),this._renderDisplay.$setAnchorOffsetX(this._pivotX),this._renderDisplay.$setAnchorOffsetX(this._pivotY);else{var t=this._renderDisplay.$DisplayObject,e=t[6];e.a=this.globalTransformMatrix.a,e.b=this.globalTransformMatrix.b,e.c=this.globalTransformMatrix.c,e.d=this.globalTransformMatrix.d,e.tx=this.globalTransformMatrix.tx-(e.a*this._pivotX+e.c*this._pivotY),e.ty=this.globalTransformMatrix.ty-(e.b*this._pivotX+e.d*this._pivotY),this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},e}(t.Slot);t.EgretSlot=e}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function r(r){void 0===r&&(r=null),e.call(this,r),t.EventObject._soundEventManager||(t.EventObject._soundEventManager=new t.EgretArmatureDisplay)}return __extends(r,e),Object.defineProperty(r,"factory",{get:function(){return r._factory||(r._factory=new r),r._factory},enumerable:!0,configurable:!0}),r.prototype._generateTextureAtlasData=function(e,r){return e?e.texture=r:e=t.BaseObject.borrowObject(t.EgretTextureAtlasData),e},r.prototype._generateArmature=function(e){var r=t.BaseObject.borrowObject(t.Armature),a=new t.EgretArmatureDisplay;return r._armatureData=e.armature,r._skinData=e.skin,r._animation=t.BaseObject.borrowObject(t.Animation),r._display=a,a._armature=r,r._animation._armature=r,r.animation.animations=e.armature.animations,r},r.prototype._generateSlot=function(e,r){var a=t.BaseObject.borrowObject(t.EgretSlot),i=r.slot,n=[];a.name=i.name,a._rawDisplay=new egret.Bitmap,a._meshDisplay=new egret.Mesh;for(var o=0,s=r.displays.length;o<s;++o){var l=r.displays[o];switch(l.type){case 0:l.texture||(l.texture=this._getTextureData(e.dataName,l.name)),n.push(a._rawDisplay);break;case 2:l.texture||(l.texture=this._getTextureData(e.dataName,l.name)),"webgl"==egret.Capabilities.renderMode?n.push(a._meshDisplay):(console.warn("Canvas can not support mesh, please change renderMode to webgl."),n.push(a._rawDisplay));break;case 1:var u=this.buildArmature(l.name,e.dataName);if(u){if(!a.inheritAnimation){var h=i.actions.length>0?i.actions:u.armatureData.actions;if(h.length>0)for(var p=0,c=h.length;p<c;++p)u._bufferAction(h[p]);else u.animation.play()}l.armature=u.armatureData}n.push(u);break;default:n.push(null)}}return a._setDisplayList(n),a},r.prototype.buildArmatureDisplay=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null);var a=this.buildArmature(t,e,r),i=a?a._display:null;return i&&i.advanceTimeBySelf(!0),i},r.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var r=this._getTextureData(e,t);if(r){if(!r.texture){var a=r.parent.texture;r.texture=new egret.Texture,r.texture._bitmapData=a._bitmapData,r.texture.$initData(r.region.x,r.region.y,r.region.width,r.region.height,0,0,r.region.width,r.region.height,a.textureWidth,a.textureHeight)}return new egret.Bitmap(r.texture)}return null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return t.EventObject._soundEventManager},enumerable:!0,configurable:!0}),r.prototype.addSkeletonData=function(t,e){void 0===e&&(e=null),this.addDragonBonesData(t,e)},r.prototype.getSkeletonData=function(t){return this.getDragonBonesData(t)},r.prototype.removeSkeletonData=function(t){this.removeDragonBonesData(t)},r.prototype.addTextureAtlas=function(t,e){void 0===e&&(e=null),this.addTextureAtlasData(t,e)},r.prototype.getTextureAtlas=function(t){return this.getTextureAtlasData(t)},r.prototype.removeTextureAtlas=function(t){this.removeTextureAtlasData(t)},r.prototype.buildFastArmature=function(t,e,r){return void 0===e&&(e=null),void 0===r&&(r=null),this.buildArmature(t,e,r)},r.prototype.dispose=function(){this.clear()},r._factory=null,r}(t.BaseFactory);t.EgretFactory=e}(dragonBones||(dragonBones={}));