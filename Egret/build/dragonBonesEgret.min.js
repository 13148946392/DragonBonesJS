var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},dragonBones;!function(t){var e=function(e){function r(t,r,n,a){e.call(this,t,r,n,a)}return __extends(r,e),Object.defineProperty(r.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),r.START=t.EventObject.START,r.LOOP_COMPLETE=t.EventObject.LOOP_COMPLETE,r.COMPLETE=t.EventObject.COMPLETE,r.FADE_IN=t.EventObject.FADE_IN,r.FADE_IN_COMPLETE=t.EventObject.FADE_IN_COMPLETE,r.FADE_OUT=t.EventObject.FADE_OUT,r.FADE_OUT_COMPLETE=t.EventObject.FADE_OUT_COMPLETE,r.FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND_EVENT=t.EventObject.SOUND_EVENT,r.ANIMATION_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.BONE_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.MOVEMENT_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND=t.EventObject.SOUND_EVENT,r}(egret.Event);t.EgretEvent=e;var r=function(r){function n(){r.call(this),n._clock||(n._clock=new t.WorldClock,n._clock.time=.001*egret.getTimer(),egret.startTick(n._clockHandler,n))}return __extends(n,r),n._clockHandler=function(t){t*=.001;var e=t-n._clock.time;return n._clock.advanceTime(e),n._clock.time=t,!1},n.prototype._onClear=function(){this._armature=null,this._debugDrawer=null},n.prototype._dispatchEvent=function(t){var r=egret.Event.create(e,t.type);r.data=t,this.dispatchEvent(r),egret.Event.release(r)},n.prototype._debugDraw=function(){this._debugDrawer||(this._debugDrawer=new egret.Shape),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),e=0,r=t.length;e<r;++e){var n=t[e],a=Math.max(n.length,5),i=n.globalTransformMatrix.tx,o=n.globalTransformMatrix.ty,s=i+n.globalTransformMatrix.a*a,l=o+n.globalTransformMatrix.b*a;this._debugDrawer.graphics.lineStyle(1,n.ik?16711680:65280,.5),this._debugDrawer.graphics.moveTo(i,o),this._debugDrawer.graphics.lineTo(s,l)}},n.prototype.hasEvent=function(t){return this.hasEventListener(t)},n.prototype.addEvent=function(t,e,r){this.addEventListener(t,e,r)},n.prototype.removeEvent=function(t,e,r){this.removeEventListener(t,e,r)},n.prototype.advanceTimeBySelf=function(t){t?n._clock.add(this._armature):n._clock.remove(this._armature)},n.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=null)},Object.defineProperty(n.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),n._clock=null,n}(egret.DisplayObjectContainer);t.EgretArmatureDisplay=r;var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.Event=n;var a=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.AnimationEvent=a;var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.FrameEvent=i;var o=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.SoundEvent=o;var s=function(e){function r(r,n,a){void 0===a&&(a=1),e.call(this),this._onClear(),this.texture=r,t.ObjectDataParser.getInstance().parseTextureAtlasData(n,this,a)}return __extends(r,e),r.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},r}(t.EgretTextureAtlasData);t.EgretTextureAtlas=s;var l=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(s);t.EgretSheetAtlas=l;var u=function(){function e(){}return e.getInstance=function(){return t.EventObject._soundEventManager},e}();t.SoundEventManager=u;var c=function(){function t(){}return t}();t.AnimationCacheManager=c}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function r(r){void 0===r&&(r=null),e.call(this,r),t.EventObject._soundEventManager||(t.EventObject._soundEventManager=new t.EgretArmatureDisplay)}return __extends(r,e),Object.defineProperty(r,"factory",{get:function(){return r._factory||(r._factory=new r),r._factory},enumerable:!0,configurable:!0}),r.prototype._generateTextureAtlasData=function(e,r){return e?e.texture=r:e=t.BaseObject.borrowObject(t.EgretTextureAtlasData),e},r.prototype._generateArmature=function(e){var r=t.BaseObject.borrowObject(t.Armature),n=new t.EgretArmatureDisplay;return r._armatureData=e.armature,r._skinData=e.skin,r._animation=t.BaseObject.borrowObject(t.Animation),r._display=n,n._armature=r,r._animation._armature=r,r.animation.animations=e.armature.animations,r},r.prototype._generateSlot=function(e,r){var n=t.BaseObject.borrowObject(t.EgretSlot),a=r.slot,i=[];n.name=a.name,n._rawDisplay=new egret.Bitmap;for(var o=0,s=r.displays.length;o<s;++o){var l=r.displays[o];switch(l.type){case 0:l.texture||(l.texture=this._getTextureData(e.dataName,l.name)),i.push(n._rawDisplay);break;case 2:l.texture||(l.texture=this._getTextureData(e.dataName,l.name)),"webgl"==egret.Capabilities.renderMode?(n._meshDisplay||(n._meshDisplay=new egret.Mesh),i.push(n._meshDisplay)):i.push(n._rawDisplay);break;case 1:var u=this.buildArmature(l.name,e.dataName);if(u){if(!n.inheritAnimation){var c=a.actions.length>0?a.actions:u.armatureData.actions;if(c.length>0)for(var p=0,h=c.length;p<h;++p)u._bufferAction(c[p]);else u.animation.play()}l.armature=u.armatureData}i.push(u);break;default:i.push(null)}}return n._setDisplayList(i),n},r.prototype.buildArmatureDisplay=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=this.buildArmature(t,e,r),a=n?n._display:null;return a&&a.advanceTimeBySelf(!0),a},r.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var r=this._getTextureData(e,t);return r?new egret.Bitmap(r.texture):null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return t.EventObject._soundEventManager},enumerable:!0,configurable:!0}),r.prototype.addSkeletonData=function(t,e){void 0===e&&(e=null),this.addDragonBonesData(t,e)},r.prototype.getSkeletonData=function(t){return this.getDragonBonesData(t)},r.prototype.removeSkeletonData=function(t){this.removeDragonBonesData(t)},r.prototype.addTextureAtlas=function(t,e){void 0===e&&(e=null),this.addTextureAtlasData(t,e)},r.prototype.getTextureAtlas=function(t){return this.getTextureAtlasData(t)},r.prototype.removeTextureAtlas=function(t){this.removeTextureAtlasData(t)},r.prototype.buildFastArmature=function(t,e,r){return void 0===e&&(e=null),void 0===r&&(r=null),this.buildArmature(t,e,r)},r.prototype.dispose=function(){this.clear()},r._factory=null,r}(t.BaseFactory);t.EgretFactory=e}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretSlot]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},e.prototype._onUpdateDisplay=function(){this._rawDisplay||(this._rawDisplay=new egret.Bitmap),this._renderDisplay=this._display||this._rawDisplay},e.prototype._initDisplay=function(t){},e.prototype._addDisplay=function(){var t=this._armature._display;t.addChild(this._renderDisplay)},e.prototype._replaceDisplay=function(t){var e=this._armature._display,r=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,r),e.removeChild(r)},e.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},e.prototype._disposeDisplay=function(t){},e.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},e.prototype._updateBlendMode=function(){if(this._blendMode<e.BLEND_MODE_LIST.length){var t=e.BLEND_MODE_LIST[this._blendMode];t&&(this._renderDisplay.blendMode=t)}},e.prototype._updateColor=function(){if(1!=this._colorTransform.redMultiplier||1!=this._colorTransform.greenMultiplier||1!=this._colorTransform.blueMultiplier||0!=this._colorTransform.redOffset||0!=this._colorTransform.greenOffset||0!=this._colorTransform.blueOffset||0!=this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var t=this._colorFilter.matrix;t[0]=this._colorTransform.redMultiplier,t[6]=this._colorTransform.greenMultiplier,t[12]=this._colorTransform.blueMultiplier,t[18]=this._colorTransform.alphaMultiplier,t[4]=this._colorTransform.redOffset,t[9]=this._colorTransform.greenOffset,t[14]=this._colorTransform.blueOffset,t[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=t;var e=this._renderDisplay.filters;e||(e=[]),e.indexOf(this._colorFilter)<0&&e.push(this._colorFilter),this._renderDisplay.filters=e}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},e.prototype._updateFilters=function(){},e.prototype._updateFrame=function(){var t=this._renderDisplay;if(this._display&&this._displayIndex>=0){var e=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,r=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,n=r||e,a=n.texture;if(a){var i=a.parent.texture;!a.texture&&i&&(a.texture=new egret.Texture,a.texture._bitmapData=i._bitmapData,a.texture.$initData(a.region.x,a.region.y,Math.min(a.region.width,i.textureWidth-a.region.x),Math.min(a.region.height,i.textureHeight-a.region.y),0,0,Math.min(a.region.width,i.textureWidth-a.region.x),Math.min(a.region.height,i.textureHeight-a.region.y),i.textureWidth,i.textureHeight));var o=this._armature._replacedTexture||a.texture;if(this._meshData&&this._display==this._meshDisplay){var s=this._meshDisplay,l=s.$renderNode;l.uvs.length=0,l.vertices.length=0,l.indices.length=0;for(var u=0,c=this._meshData.vertices.length;u<c;++u)l.uvs[u]=this._meshData.uvs[u],l.vertices[u]=this._meshData.vertices[u];for(var u=0,c=this._meshData.vertexIndices.length;u<c;++u)l.indices[u]=this._meshData.vertexIndices[u];if(this._pivotX=0,this._pivotY=0,o&&s.$setBitmapData(o),s.$updateVertices(),s.$invalidateTransform(),this._meshData.skinned){var p=s.matrix;p.identity(),s.matrix=p}}else{var h=a.frame||a.region,_=h.width,d=h.height;a.rotated&&(_=h.height,d=h.width),this._pivotX=n.pivot.x,this._pivotY=n.pivot.y,n.isRelativePivot&&(this._pivotX=_*this._pivotX,this._pivotY=d*this._pivotY),a.frame&&(this._pivotX+=a.frame.x,this._pivotY+=a.frame.y),e&&e!=n&&(this._pivotX+=e.transform.x-n.transform.x,this._pivotY+=e.transform.y-n.transform.y),o&&t.$setBitmapData(o),t.$setAnchorOffsetX(this._pivotX),t.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}this._pivotX=0,this._pivotY=0,t.visible=!1,t.$setBitmapData(null),t.$setAnchorOffsetX(0),t.$setAnchorOffsetY(0),t.x=this.origin.x,t.y=this.origin.y},e.prototype._updateMesh=function(){var t=this._meshDisplay,e=t.$renderNode,r=this._ffdVertices.length>0;if(this._meshData.skinned){for(var n=0,a=0,i=this._meshData.vertices.length;n<i;n+=2){for(var o=n/2,s=this._meshData.boneIndices[o],l=this._meshData.boneVertices[o],u=this._meshData.weights[o],c=0,p=0,h=0,_=s.length;h<_;++h){var d=this._meshBones[s[h]],f=d.globalTransformMatrix,m=u[h],g=0,v=0;r?(g=l[2*h]+this._ffdVertices[a],v=l[2*h+1]+this._ffdVertices[a+1]):(g=l[2*h],v=l[2*h+1]),c+=(f.a*g+f.c*v+f.tx)*m,p+=(f.b*g+f.d*v+f.ty)*m,a+=2}e.vertices[n]=c,e.vertices[n+1]=p}t.$updateVertices(),t.$invalidateTransform()}else if(r){for(var y=this._meshData.vertices,n=0,i=this._meshData.vertices.length;n<i;n+=2){var c=y[n]+this._ffdVertices[n],p=y[n+1]+this._ffdVertices[n+1];e.vertices[n]=c,e.vertices[n+1]=p}t.$updateVertices(),t.$invalidateTransform()}},e.prototype._updateTransform=function(){this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled)},e.BLEND_MODE_LIST=[egret.BlendMode.NORMAL,egret.BlendMode.ADD,null,null,null,egret.BlendMode.ERASE,null,null,null,null,null,null,null,null],e}(t.Slot);t.EgretSlot=e}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function n(){e.call(this)}return __extends(n,e),n.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture=null)},n.prototype.generateTextureData=function(){return t.BaseObject.borrowObject(r)},n}(t.TextureAtlasData);t.EgretTextureAtlasData=e;var r=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture.dispose(),this.texture=null)},e}(t.TextureData);t.EgretTextureData=r}(dragonBones||(dragonBones={}));