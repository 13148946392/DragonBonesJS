var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},dragonBones;!function(t){var e=function(e){function a(){e.call(this)}return __extends(a,e),a.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture=null)},a.prototype.generateTextureData=function(){return t.BaseObject.borrowObject(r)},a.prototype.dispose=function(){this.returnToPool()},a}(t.TextureAtlasData);t.EgretTextureAtlasData=e;var r=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture=null)},e}(t.TextureData);t.EgretTextureData=r}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function r(t,r,a,n){e.call(this,t,r,a,n)}return __extends(r,e),Object.defineProperty(r.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),r.START=t.EventObject.START,r.LOOP_COMPLETE=t.EventObject.LOOP_COMPLETE,r.COMPLETE=t.EventObject.COMPLETE,r.FADE_IN=t.EventObject.FADE_IN,r.FADE_IN_COMPLETE=t.EventObject.FADE_IN_COMPLETE,r.FADE_OUT=t.EventObject.FADE_OUT,r.FADE_OUT_COMPLETE=t.EventObject.FADE_OUT_COMPLETE,r.FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND_EVENT=t.EventObject.SOUND_EVENT,r.ANIMATION_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.BONE_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.MOVEMENT_FRAME_EVENT=t.EventObject.FRAME_EVENT,r.SOUND=t.EventObject.SOUND_EVENT,r}(egret.Event);t.EgretEvent=e;var r=function(r){function a(){r.call(this),this._subTextures={}}return __extends(a,r),a.prototype._onClear=function(){for(var t in this._subTextures)delete this._subTextures[t];this._armature&&this.advanceTimeBySelf(!1),this._armature=null,this._debugDrawer=null},a.prototype._dispatchEvent=function(t){var r=egret.Event.create(e,t.type);r.data=t,this.dispatchEvent(r),egret.Event.release(r)},a.prototype._debugDraw=function(){this._debugDrawer||(this._debugDrawer=new egret.Shape),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),e=0,r=t.length;e<r;++e){var a=t[e],n=Math.max(a.length,5),i=a.globalTransformMatrix.tx,o=a.globalTransformMatrix.ty,s=i+a.globalTransformMatrix.a*n,l=o+a.globalTransformMatrix.b*n;this._debugDrawer.graphics.lineStyle(1,a.ik?16711680:65280,.5),this._debugDrawer.graphics.moveTo(i,o),this._debugDrawer.graphics.lineTo(s,l)}},a.prototype._onReplaceTexture=function(t){for(var e in this._subTextures)delete this._subTextures[e]},a.prototype.hasEvent=function(t){return this.hasEventListener(t)},a.prototype.addEvent=function(t,e,r){},a.prototype.removeEvent=function(t,e,r){},a.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=null)},a.prototype.advanceTimeBySelf=function(e){e?t.EgretFactory._clock.add(this._armature):t.EgretFactory._clock.remove(this._armature)},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a}(egret.DisplayObjectContainer);t.EgretArmatureDisplay=r;var a=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.Event=a;var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.ArmatureEvent=n;var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.AnimationEvent=i;var o=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.FrameEvent=o;var s=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(e);t.SoundEvent=s;var l=function(e){function r(r,a,n){void 0===n&&(n=1),e.call(this),this._onClear(),this.texture=r,t.ObjectDataParser.getInstance().parseTextureAtlasData(a,this,n)}return __extends(r,e),r.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},r}(t.EgretTextureAtlasData);t.EgretTextureAtlas=l;var u=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(l);t.EgretSheetAtlas=u;var c=function(){function e(){}return e.getInstance=function(){return t.EgretFactory._eventManager},e}();t.SoundEventManager=c;var p=function(){function t(){}return t}();t.AnimationCacheManager=p}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretSlot]"},e.prototype._createTexture=function(t,e){var r=e.width,a=e.height,n=Math.min(t.region.width,r-t.region.x),i=Math.min(t.region.height,a-t.region.y),o=new egret.Texture;return o._bitmapData=e,o.$initData(t.region.x,t.region.y,n,i,0,0,n,i,r,a),o},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},e.prototype._initDisplay=function(t){},e.prototype._disposeDisplay=function(t){},e.prototype._onUpdateDisplay=function(){this._rawDisplay||(this._rawDisplay=new egret.Bitmap),this._renderDisplay=this._display||this._rawDisplay},e.prototype._addDisplay=function(){var t=this._armature._display;t.addChild(this._renderDisplay)},e.prototype._replaceDisplay=function(t){var e=this._armature._display,r=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,r),e.removeChild(r)},e.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},e.prototype._updateZOrder=function(){var t=this._armature._display;t.addChildAt(this._renderDisplay,this._zOrder)},e.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},e.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},e.prototype._updateColor=function(){if(1!=this._colorTransform.redMultiplier||1!=this._colorTransform.greenMultiplier||1!=this._colorTransform.blueMultiplier||0!=this._colorTransform.redOffset||0!=this._colorTransform.greenOffset||0!=this._colorTransform.blueOffset||0!=this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var t=this._colorFilter.matrix;t[0]=this._colorTransform.redMultiplier,t[6]=this._colorTransform.greenMultiplier,t[12]=this._colorTransform.blueMultiplier,t[18]=this._colorTransform.alphaMultiplier,t[4]=this._colorTransform.redOffset,t[9]=this._colorTransform.greenOffset,t[14]=this._colorTransform.blueOffset,t[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=t;var e=this._renderDisplay.filters;e||(e=[]),e.indexOf(this._colorFilter)<0&&e.push(this._colorFilter),this._renderDisplay.filters=e}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},e.prototype._updateFilters=function(){},e.prototype._updateFrame=function(){if(this._display&&this._displayIndex>=0){var t=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,e=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,r=e||t,a=r.texture;if(a){var n=a.parent,i=this._armature.replacedTexture?this._armature.replacedTexture._bitmapData:null,o=i&&r.texture.parent==t.texture.parent?i:n.texture?n.texture._bitmapData:null;if(o){var s=a.texture;if(o==i){var l=this._armature._display,u=a.name;s=l._subTextures[u],s||(s=this._createTexture(a,o),l._subTextures[u]=s)}else a.texture||(s=this._createTexture(a,o),a.texture=s);if(this._updatePivot(t,r,a),this._meshData&&this._display==this._meshDisplay){var c=this._meshDisplay,p=c.$renderNode;p.uvs.length=0,p.vertices.length=0,p.indices.length=0;for(var h=0,_=this._meshData.vertices.length;h<_;++h)p.uvs[h]=this._meshData.uvs[h],p.vertices[h]=this._meshData.vertices[h];for(var h=0,_=this._meshData.vertexIndices.length;h<_;++h)p.indices[h]=this._meshData.vertexIndices[h];if(c.$setBitmapData(s),c.$setAnchorOffsetX(this._pivotX),c.$setAnchorOffsetY(this._pivotY),c.$updateVertices(),c.$invalidateTransform(),this._meshData.skinned){var d=c.matrix;d.identity(),c.matrix=d}}else{var f=this._display;f.$setBitmapData(s),f.$setAnchorOffsetX(this._pivotX),f.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}}this._pivotX=0,this._pivotY=0;var m=this._renderDisplay;m.visible=!1,m.$setBitmapData(null),m.$setAnchorOffsetX(this._pivotX),m.$setAnchorOffsetY(this._pivotY),m.x=this.origin.x,m.y=this.origin.y},e.prototype._updateMesh=function(){var t=this._meshDisplay,e=t.$renderNode,r=this._ffdVertices.length>0;if(this._meshData.skinned){for(var a=0,n=0,i=this._meshData.vertices.length;a<i;a+=2){for(var o=a/2,s=this._meshData.boneIndices[o],l=this._meshData.boneVertices[o],u=this._meshData.weights[o],c=0,p=0,h=0,_=s.length;h<_;++h){var d=this._meshBones[s[h]],f=d.globalTransformMatrix,m=u[h],g=0,y=0;r?(g=l[2*h]+this._ffdVertices[n],y=l[2*h+1]+this._ffdVertices[n+1]):(g=l[2*h],y=l[2*h+1]),c+=(f.a*g+f.c*y+f.tx)*m,p+=(f.b*g+f.d*y+f.ty)*m,n+=2}e.vertices[a]=c,e.vertices[a+1]=p}t.$updateVertices(),t.$invalidateTransform()}else if(r){for(var v=this._meshData.vertices,a=0,i=this._meshData.vertices.length;a<i;a+=2){var c=v[a]+this._ffdVertices[a],p=v[a+1]+this._ffdVertices[a+1];e.vertices[a]=c,e.vertices[a+1]=p}t.$updateVertices(),t.$invalidateTransform()}},e.prototype._updateTransform=function(){if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled),this._renderDisplay.$setAnchorOffsetX(this._pivotX),this._renderDisplay.$setAnchorOffsetX(this._pivotY);else{var t=this._renderDisplay.$DisplayObject,e=t[6];e.a=this.globalTransformMatrix.a,e.b=this.globalTransformMatrix.b,e.c=this.globalTransformMatrix.c,e.d=this.globalTransformMatrix.d,e.tx=this.globalTransformMatrix.tx,e.ty=this.globalTransformMatrix.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},e}(t.Slot);t.EgretSlot=e}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function r(a){void 0===a&&(a=null),e.call(this,a),r._eventManager||(r._eventManager=new t.EgretArmatureDisplay,r._clock=new t.WorldClock,r._clock.time=.001*egret.getTimer(),egret.startTick(r._clockHandler,r))}return __extends(r,e),r._clockHandler=function(t){t*=.001;var e=t-r._clock.time;return r._clock.advanceTime(e),r._clock.time=t,!1},Object.defineProperty(r,"factory",{get:function(){return r._factory||(r._factory=new r),r._factory},enumerable:!0,configurable:!0}),r.prototype._generateTextureAtlasData=function(e,r){return e?e.texture=r:e=t.BaseObject.borrowObject(t.EgretTextureAtlasData),e},r.prototype._generateArmature=function(e){var a=t.BaseObject.borrowObject(t.Armature),n=new t.EgretArmatureDisplay;return a._armatureData=e.armature,a._skinData=e.skin,a._animation=t.BaseObject.borrowObject(t.Animation),a._display=n,a._eventManager=r._eventManager,n._armature=a,a._animation._armature=a,a.animation.animations=e.armature.animations,a},r.prototype._generateSlot=function(e,r,a){var n=t.BaseObject.borrowObject(t.EgretSlot),i=r.slot,o=[];n.name=i.name,n._rawDisplay=new egret.Bitmap,n._meshDisplay=new egret.Mesh;for(var s=0,l=r.displays.length;s<l;++s){var u=r.displays[s];switch(u.type){case 0:u.texture&&!e.textureAtlasName||(u.texture=this._getTextureData(e.textureAtlasName||e.dataName,u.name)),o.push(n._rawDisplay);break;case 2:u.texture&&!e.textureAtlasName||(u.texture=this._getTextureData(e.textureAtlasName||e.dataName,u.name)),"webgl"==egret.Capabilities.renderMode?o.push(n._meshDisplay):(console.warn("Canvas can not support mesh, please change renderMode to webgl."),o.push(n._rawDisplay));break;case 1:var c=this.buildArmature(u.name,e.dataName,null,e.textureAtlasName);if(c){if(!n.inheritAnimation){var p=i.actions.length>0?i.actions:c.armatureData.actions;if(p.length>0)for(var h=0,_=p.length;h<_;++h)c._bufferAction(p[h]);else c.animation.play()}u.armature=c.armatureData}o.push(c);break;default:o.push(null)}}return n._setDisplayList(o),n},r.prototype.buildArmatureDisplay=function(t,e,r,a){void 0===e&&(e=null),void 0===r&&(r=null),void 0===a&&(a=null);var n=this.buildArmature(t,e,r,a),i=n?n._display:null;return i&&i.advanceTimeBySelf(!0),i},r.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var r=this._getTextureData(e,t);if(r){if(!r.texture){var a=r.parent.texture;r.texture=new egret.Texture,r.texture._bitmapData=a._bitmapData,r.texture.$initData(r.region.x,r.region.y,r.region.width,r.region.height,0,0,r.region.width,r.region.height,a.textureWidth,a.textureHeight)}return new egret.Bitmap(r.texture)}return null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return r._eventManager},enumerable:!0,configurable:!0}),r.prototype.addSkeletonData=function(t,e){void 0===e&&(e=null),this.addDragonBonesData(t,e)},r.prototype.getSkeletonData=function(t){return this.getDragonBonesData(t)},r.prototype.removeSkeletonData=function(t){this.removeDragonBonesData(t)},r.prototype.addTextureAtlas=function(t,e){void 0===e&&(e=null),this.addTextureAtlasData(t,e)},r.prototype.getTextureAtlas=function(t){return this.getTextureAtlasData(t)},r.prototype.removeTextureAtlas=function(t){this.removeTextureAtlasData(t)},r.prototype.buildFastArmature=function(t,e,r){return void 0===e&&(e=null),void 0===r&&(r=null),this.buildArmature(t,e,r)},r.prototype.dispose=function(){this.clear()},r._factory=null,r._eventManager=null,r._clock=null,r}(t.BaseFactory);t.EgretFactory=e}(dragonBones||(dragonBones={}));