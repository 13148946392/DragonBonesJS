var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},dragonBones;!function(e){var t=function(t){function a(){t.call(this)}return __extends(a,t),a.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture=null)},a.prototype.generateTextureData=function(){return e.BaseObject.borrowObject(r)},a.prototype.dispose=function(){this.returnToPool()},a}(e.TextureAtlasData);e.EgretTextureAtlasData=t;var r=function(e){function t(){e.call(this)}return __extends(t,e),t.toString=function(){return"[class dragonBones.EgretTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture=null)},t}(e.TextureData);e.EgretTextureData=r}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(e,r,a,i){t.call(this,e,r,a,i)}return __extends(r,t),Object.defineProperty(r.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),r.START=e.EventObject.START,r.LOOP_COMPLETE=e.EventObject.LOOP_COMPLETE,r.COMPLETE=e.EventObject.COMPLETE,r.FADE_IN=e.EventObject.FADE_IN,r.FADE_IN_COMPLETE=e.EventObject.FADE_IN_COMPLETE,r.FADE_OUT=e.EventObject.FADE_OUT,r.FADE_OUT_COMPLETE=e.EventObject.FADE_OUT_COMPLETE,r.FRAME_EVENT=e.EventObject.FRAME_EVENT,r.SOUND_EVENT=e.EventObject.SOUND_EVENT,r.ANIMATION_FRAME_EVENT=e.EventObject.FRAME_EVENT,r.BONE_FRAME_EVENT=e.EventObject.FRAME_EVENT,r.MOVEMENT_FRAME_EVENT=e.EventObject.FRAME_EVENT,r.SOUND=e.EventObject.SOUND_EVENT,r}(egret.Event);e.EgretEvent=t;var r=function(r){function a(){r.call(this),this._subTextures={}}return __extends(a,r),a.prototype._onClear=function(){for(var e in this._subTextures)delete this._subTextures[e];this._armature&&this.advanceTimeBySelf(!1),this._armature=null,this._debugDrawer=null},a.prototype._dispatchEvent=function(e){var r=egret.Event.create(t,e.type);r.data=e,this.dispatchEvent(r),egret.Event.release(r)},a.prototype._debugDraw=function(e){if(this._debugDrawer||(this._debugDrawer=new egret.Sprite),e){this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),r=0,a=t.length;r<a;++r){var i=t[r],n=i.length,s=i.globalTransformMatrix.tx,o=i.globalTransformMatrix.ty,l=s+i.globalTransformMatrix.a*n,u=o+i.globalTransformMatrix.b*n;this._debugDrawer.graphics.lineStyle(2,i.ik?16711680:65535,.7),this._debugDrawer.graphics.moveTo(s,o),this._debugDrawer.graphics.lineTo(l,u),this._debugDrawer.graphics.lineStyle(0,0,0),this._debugDrawer.graphics.beginFill(65535,.7),this._debugDrawer.graphics.drawCircle(s,o,3),this._debugDrawer.graphics.endFill()}for(var h=this._armature.getSlots(),r=0,a=h.length;r<a;++r){var c=h[r],p=c.displayData;if(p&&p.boundingBox){var d=p.boundingBox,_=this._debugDrawer.getChildByName(c.name);switch(_||(_=new egret.Shape,_.name=c.name,this._debugDrawer.addChild(_)),_.graphics.clear(),_.graphics.beginFill(16711935,.3),d.type){case 0:_.graphics.drawRect(.5*-d.width,.5*-d.height,d.width,d.height);break;case 1:_.graphics.drawEllipse(.5*-d.width,.5*-d.height,d.width,d.height);break;case 2:for(var f=d.vertices,g=0,m=d.vertices.length;g<m;g+=2)0==g?_.graphics.moveTo(f[g],f[g+1]):_.graphics.lineTo(f[g],f[g+1])}_.graphics.endFill(),0==c._blendIndex&&(c._blendIndex=1,c._updateLocalTransformMatrix(),c._updateGlobalTransformMatrix()),_.$setMatrix(c.globalTransformMatrix,!1)}else{var _=this._debugDrawer.getChildByName(c.name);_&&this._debugDrawer.removeChild(_)}}}else this._debugDrawer&&this.contains(this._debugDrawer)&&this.removeChild(this._debugDrawer)},a.prototype._onReplaceTexture=function(e){for(var t in this._subTextures)delete this._subTextures[t]},a.prototype.hasEvent=function(e){return this.hasEventListener(e)},a.prototype.addEvent=function(e,t,r){this.addEventListener(e,t,r)},a.prototype.removeEvent=function(e,t,r){this.removeEventListener(e,t,r)},a.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=null)},a.prototype.advanceTimeBySelf=function(t){t?e.EgretFactory._clock.add(this._armature):e.EgretFactory._clock.remove(this._armature)},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a}(egret.DisplayObjectContainer);e.EgretArmatureDisplay=r;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Event=a;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.ArmatureEvent=i;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AnimationEvent=n;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.FrameEvent=s;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.SoundEvent=o;var l=function(t){function r(r,a,i){void 0===i&&(i=1),t.call(this),this._onClear(),this.texture=r,e.ObjectDataParser.getInstance().parseTextureAtlasData(a,this,i)}return __extends(r,t),r.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},r}(e.EgretTextureAtlasData);e.EgretTextureAtlas=l;var u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(l);e.EgretSheetAtlas=u;var h=function(){function t(){}return t.getInstance=function(){return e.EgretFactory._eventManager},t}();e.SoundEventManager=h;var c=function(){function e(){}return e}();e.AnimationCacheManager=c}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(e){function t(){e.call(this)}return __extends(t,e),t.toString=function(){return"[class dragonBones.EgretSlot]"},t.prototype._createTexture=function(e,t){var r=t.width,a=t.height,i=Math.min(e.region.width,r-e.region.x),n=Math.min(e.region.height,a-e.region.y),s=new egret.Texture;return s._bitmapData=t,s.$initData(e.region.x,e.region.y,i,n,0,0,i,n,r,a),s},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},t.prototype._initDisplay=function(e){},t.prototype._disposeDisplay=function(e){},t.prototype._onUpdateDisplay=function(){this._rawDisplay||(this._rawDisplay=new egret.Bitmap),this._renderDisplay=this._display||this._rawDisplay},t.prototype._addDisplay=function(){var e=this._armature._display;e.addChild(this._renderDisplay)},t.prototype._replaceDisplay=function(e){var t=this._armature._display,r=e;t.addChild(this._renderDisplay),t.swapChildren(this._renderDisplay,r),t.removeChild(r)},t.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},t.prototype._updateZOrder=function(){var e=this._armature._display,t=e.getChildIndex(this._renderDisplay);t!=this._zOrder&&e.addChildAt(this._renderDisplay,t<this._zOrder?this._zOrder:this._zOrder+1)},t.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},t.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},t.prototype._updateColor=function(){if(1!=this._colorTransform.redMultiplier||1!=this._colorTransform.greenMultiplier||1!=this._colorTransform.blueMultiplier||0!=this._colorTransform.redOffset||0!=this._colorTransform.greenOffset||0!=this._colorTransform.blueOffset||0!=this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var e=this._colorFilter.matrix;e[0]=this._colorTransform.redMultiplier,e[6]=this._colorTransform.greenMultiplier,e[12]=this._colorTransform.blueMultiplier,e[18]=this._colorTransform.alphaMultiplier,e[4]=this._colorTransform.redOffset,e[9]=this._colorTransform.greenOffset,e[14]=this._colorTransform.blueOffset,e[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=e;var t=this._renderDisplay.filters;t||(t=[]),t.indexOf(this._colorFilter)<0&&t.push(this._colorFilter),this._renderDisplay.filters=t}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},t.prototype._updateFilters=function(){},t.prototype._updateFrame=function(){if(this._display&&this._displayIndex>=0){var e=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,t=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,r=t||e,a=r.texture;if(a){var i=a.parent,n=this._armature.replacedTexture?this._armature.replacedTexture._bitmapData:null,s=n&&r.texture.parent==e.texture.parent?n:i.texture?i.texture._bitmapData:null;if(s){var o=a.texture;if(s==n){var l=this._armature._display,u=a.name;o=l._subTextures[u],o||(o=this._createTexture(a,s),l._subTextures[u]=o)}else a.texture||(o=this._createTexture(a,s),a.texture=o);if(this._updatePivot(e,r,a),this._meshData&&this._display==this._meshDisplay){var h=this._meshDisplay,c=h.$renderNode;c.uvs.length=0,c.vertices.length=0,c.indices.length=0;for(var p=0,d=this._meshData.vertices.length;p<d;++p)c.uvs[p]=this._meshData.uvs[p],c.vertices[p]=this._meshData.vertices[p];for(var p=0,d=this._meshData.vertexIndices.length;p<d;++p)c.indices[p]=this._meshData.vertexIndices[p];if(h.$setBitmapData(o),h.$setAnchorOffsetX(this._pivotX),h.$setAnchorOffsetY(this._pivotY),h.$updateVertices(),h.$invalidateTransform(),this._meshData.skinned){var _=h.matrix;_.identity(),h.matrix=_}}else{var f=this._display;f.$setBitmapData(o),f.$setAnchorOffsetX(this._pivotX),f.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}}this._pivotX=0,this._pivotY=0;var g=this._renderDisplay;g.visible=!1,g.$setBitmapData(null),g.$setAnchorOffsetX(this._pivotX),g.$setAnchorOffsetY(this._pivotY),g.x=this.origin.x,g.y=this.origin.y},t.prototype._updateMesh=function(){var e=this._meshDisplay,t=e.$renderNode,r=this._ffdVertices.length>0;if(this._meshData.skinned){for(var a=0,i=0,n=this._meshData.vertices.length;a<n;a+=2){for(var s=a/2,o=this._meshData.boneIndices[s],l=this._meshData.boneVertices[s],u=this._meshData.weights[s],h=0,c=0,p=0,d=o.length;p<d;++p){var _=this._meshBones[o[p]],f=_.globalTransformMatrix,g=u[p],m=0,y=0;r?(m=l[2*p]+this._ffdVertices[i],y=l[2*p+1]+this._ffdVertices[i+1]):(m=l[2*p],y=l[2*p+1]),h+=(f.a*m+f.c*y+f.tx)*g,c+=(f.b*m+f.d*y+f.ty)*g,i+=2}t.vertices[a]=h,t.vertices[a+1]=c}e.$updateVertices(),e.$invalidateTransform()}else if(r){for(var v=this._meshData.vertices,a=0,n=this._meshData.vertices.length;a<n;a+=2){var h=v[a]+this._ffdVertices[a],c=v[a+1]+this._ffdVertices[a+1];t.vertices[a]=h,t.vertices[a+1]=c}e.$updateVertices(),e.$invalidateTransform()}},t.prototype._updateTransform=function(){if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled),this._renderDisplay.$setAnchorOffsetX(this._pivotX),this._renderDisplay.$setAnchorOffsetX(this._pivotY);else{var e=this._renderDisplay.$DisplayObject,t=e[6];t.a=this.globalTransformMatrix.a,t.b=this.globalTransformMatrix.b,t.c=this.globalTransformMatrix.c,t.d=this.globalTransformMatrix.d,t.tx=this.globalTransformMatrix.tx,t.ty=this.globalTransformMatrix.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},t}(e.Slot);e.EgretSlot=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(a){void 0===a&&(a=null),t.call(this,a),r._eventManager||(r._eventManager=new e.EgretArmatureDisplay,r._clock=new e.WorldClock,r._clock.time=.001*egret.getTimer(),egret.startTick(r._clockHandler,r))}return __extends(r,t),r._clockHandler=function(e){e*=.001;var t=e-r._clock.time;return r._clock.advanceTime(t),r._clock.time=e,!1},Object.defineProperty(r,"factory",{get:function(){return r._factory||(r._factory=new r),r._factory},enumerable:!0,configurable:!0}),r.prototype._generateTextureAtlasData=function(t,r){return t?t.texture=r:t=e.BaseObject.borrowObject(e.EgretTextureAtlasData),t},r.prototype._generateArmature=function(t){var a=e.BaseObject.borrowObject(e.Armature),i=new e.EgretArmatureDisplay;return a._armatureData=t.armature,a._skinData=t.skin,a._animation=e.BaseObject.borrowObject(e.Animation),a._display=i,a._eventManager=r._eventManager,i._armature=a,a._animation._armature=a,a.animation.animations=t.armature.animations,a},r.prototype._generateSlot=function(t,r,a){var i=e.BaseObject.borrowObject(e.EgretSlot),n=r.slot,s=[];i.name=n.name,i._rawDisplay=new egret.Bitmap,i._meshDisplay=new egret.Mesh;for(var o=0,l=r.displays.length;o<l;++o){var u=r.displays[o];switch(u.type){case 0:u.texture&&!t.textureAtlasName||(u.texture=this._getTextureData(t.textureAtlasName||t.dataName,u.path)),s.push(i._rawDisplay);break;case 2:u.texture&&!t.textureAtlasName||(u.texture=this._getTextureData(t.textureAtlasName||t.dataName,u.path)),"webgl"==egret.Capabilities.renderMode?s.push(i._meshDisplay):(console.warn("Canvas can not support mesh, please change renderMode to webgl."),s.push(i._rawDisplay));break;case 1:var h=this.buildArmature(u.path,t.dataName,null,t.textureAtlasName);if(h){if(!i.inheritAnimation){var c=n.actions.length>0?n.actions:h.armatureData.actions;if(c.length>0)for(var p=0,d=c.length;p<d;++p)h._bufferAction(c[p]);else h.animation.play()}u.armature=h.armatureData}s.push(h);break;default:s.push(null)}}return i._setDisplayList(s),i},r.prototype.buildArmatureDisplay=function(e,t,r,a){void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null);var i=this.buildArmature(e,t,r,a),n=i?i._display:null;return n&&n.advanceTimeBySelf(!0),n},r.prototype.getTextureDisplay=function(e,t){void 0===t&&(t=null);var r=this._getTextureData(t,e);if(r){if(!r.texture){var a=r.parent.texture;r.texture=new egret.Texture,r.texture._bitmapData=a._bitmapData,r.texture.$initData(r.region.x,r.region.y,r.region.width,r.region.height,0,0,r.region.width,r.region.height,a.textureWidth,a.textureHeight)}return new egret.Bitmap(r.texture)}return null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return r._eventManager},enumerable:!0,configurable:!0}),r.prototype.addSkeletonData=function(e,t){void 0===t&&(t=null),this.addDragonBonesData(e,t)},r.prototype.getSkeletonData=function(e){return this.getDragonBonesData(e)},r.prototype.removeSkeletonData=function(e){this.removeDragonBonesData(e)},r.prototype.addTextureAtlas=function(e,t){void 0===t&&(t=null),this.addTextureAtlasData(e,t)},r.prototype.getTextureAtlas=function(e){return this.getTextureAtlasData(e)},r.prototype.removeTextureAtlas=function(e){this.removeTextureAtlasData(e)},r.prototype.buildFastArmature=function(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.buildArmature(e,t,r)},r.prototype.dispose=function(){this.clear()},r._factory=null,r._eventManager=null,r._clock=null,r}(e.BaseFactory);e.EgretFactory=t}(dragonBones||(dragonBones={}));