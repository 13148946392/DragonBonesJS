var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},dragonBones;!function(e){var t=function(t){function r(){t.call(this)}return __extends(r,t),r.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},r.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture=null)},r.prototype.generateTexture=function(){return e.BaseObject.borrowObject(i)},r.prototype.dispose=function(){this.returnToPool()},r}(e.TextureAtlasData);e.EgretTextureAtlasData=t;var i=function(e){function t(){e.call(this)}return __extends(t,e),t.toString=function(){return"[class dragonBones.EgretTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture=null)},t}(e.TextureData);e.EgretTextureData=i}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function i(e,i,r,a){t.call(this,e,i,r,a)}return __extends(i,t),Object.defineProperty(i.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),i.START=e.EventObject.START,i.LOOP_COMPLETE=e.EventObject.LOOP_COMPLETE,i.COMPLETE=e.EventObject.COMPLETE,i.FADE_IN=e.EventObject.FADE_IN,i.FADE_IN_COMPLETE=e.EventObject.FADE_IN_COMPLETE,i.FADE_OUT=e.EventObject.FADE_OUT,i.FADE_OUT_COMPLETE=e.EventObject.FADE_OUT_COMPLETE,i.FRAME_EVENT=e.EventObject.FRAME_EVENT,i.SOUND_EVENT=e.EventObject.SOUND_EVENT,i.ANIMATION_FRAME_EVENT=e.EventObject.FRAME_EVENT,i.BONE_FRAME_EVENT=e.EventObject.FRAME_EVENT,i.MOVEMENT_FRAME_EVENT=e.EventObject.FRAME_EVENT,i.SOUND=e.EventObject.SOUND_EVENT,i}(egret.Event);e.EgretEvent=t;var i=function(i){function r(){i.call(this)}return __extends(r,i),r.prototype._onClear=function(){this._disposeProxy=!1,this._armature=null,this._debugDrawer=null},r.prototype._dispatchEvent=function(e,r){var a=egret.Event.create(t,e);a.data=r,i.prototype.dispatchEvent.call(this,a),egret.Event.release(a)},r.prototype._debugDraw=function(e){if(e){this._debugDrawer||(this._debugDrawer=new egret.Sprite),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),i=0,r=t.length;i<r;++i){var a=t[i],n=a.length,s=a.globalTransformMatrix.tx,o=a.globalTransformMatrix.ty,l=s+a.globalTransformMatrix.a*n,h=o+a.globalTransformMatrix.b*n;this._debugDrawer.graphics.lineStyle(2,a.ik?16711680:65535,.7),this._debugDrawer.graphics.moveTo(s,o),this._debugDrawer.graphics.lineTo(l,h),this._debugDrawer.graphics.lineStyle(0,0,0),this._debugDrawer.graphics.beginFill(65535,.7),this._debugDrawer.graphics.drawCircle(s,o,3),this._debugDrawer.graphics.endFill()}for(var c=this._armature.getSlots(),i=0,r=c.length;i<r;++i){var p=c[i],u=p.boundingBoxData;if(u){var d=this._debugDrawer.getChildByName(p.name);switch(d||(d=new egret.Shape,d.name=p.name,this._debugDrawer.addChild(d)),d.graphics.clear(),d.graphics.beginFill(u.color?u.color:16711935,.3),u.type){case 0:d.graphics.drawRect(.5*-u.width,.5*-u.height,u.width,u.height);break;case 1:d.graphics.drawEllipse(.5*-u.width,.5*-u.height,u.width,u.height);break;case 2:for(var f=u.vertices,_=0,g=u.vertices.length;_<g;_+=2)0===_?d.graphics.moveTo(f[_],f[_+1]):d.graphics.lineTo(f[_],f[_+1])}d.graphics.endFill(),p._updateTransformAndMatrix(),d.$setMatrix(p.globalTransformMatrix,!1)}else{var d=this._debugDrawer.getChildByName(p.name);d&&this._debugDrawer.removeChild(d)}}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},r.prototype.dispose=function(e){void 0===e&&(e=!0),this._disposeProxy=e,this._armature&&(this._armature.dispose(),this._armature=null)},r.prototype.hasEvent=function(e){return this.hasEventListener(e)},r.prototype.addEvent=function(e,t,i){this.addEventListener(e,t,i)},r.prototype.removeEvent=function(e,t,i){this.removeEventListener(e,t,i)},Object.defineProperty(r.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),r.prototype.advanceTimeBySelf=function(t){t?this._armature.clock=e.EgretFactory._clock:this._armature.clock=null},r}(egret.DisplayObjectContainer);e.EgretArmatureDisplay=i;var r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Event=r;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.ArmatureEvent=a;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AnimationEvent=n;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.FrameEvent=s;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.SoundEvent=o;var l=function(t){function i(i,r,a){void 0===a&&(a=1),t.call(this),this._onClear(),this.texture=i,e.ObjectDataParser.getInstance().parseTextureAtlasData(r,this,a)}return __extends(i,t),i.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},i}(e.EgretTextureAtlasData);e.EgretTextureAtlas=l;var h=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(l);e.EgretSheetAtlas=h;var c=function(){function t(){}return t.getInstance=function(){return e.EgretFactory._eventManager},t}();e.SoundEventManager=c;var p=function(){function e(){}return e}();e.AnimationCacheManager=p}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function i(){t.call(this)}return __extends(i,t),i.toString=function(){return"[class dragonBones.EgretSlot]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},i.prototype._initDisplay=function(e){},i.prototype._disposeDisplay=function(e){},i.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},i.prototype._addDisplay=function(){var e=this._armature.display;e.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(e){var t=this._armature.display,i=e;t.addChild(this._renderDisplay),t.swapChildren(this._renderDisplay,i),t.removeChild(i)},i.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var e=this._armature.display,t=e.getChildIndex(this._renderDisplay);t!==this._zOrder&&e.addChildAt(this._renderDisplay,t<this._zOrder?this._zOrder:this._zOrder+1)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},i.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},i.prototype._updateColor=function(){if(1!==this._colorTransform.redMultiplier||1!==this._colorTransform.greenMultiplier||1!==this._colorTransform.blueMultiplier||0!==this._colorTransform.redOffset||0!==this._colorTransform.greenOffset||0!==this._colorTransform.blueOffset||0!==this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var e=this._colorFilter.matrix;e[0]=this._colorTransform.redMultiplier,e[6]=this._colorTransform.greenMultiplier,e[12]=this._colorTransform.blueMultiplier,e[18]=this._colorTransform.alphaMultiplier,e[4]=this._colorTransform.redOffset,e[9]=this._colorTransform.greenOffset,e[14]=this._colorTransform.blueOffset,e[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=e;var t=this._renderDisplay.filters;t||(t=[]),t.indexOf(this._colorFilter)<0&&t.push(this._colorFilter),this._renderDisplay.filters=t}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},i.prototype._updateFrame=function(){var t=this._meshData&&this._display===this._meshDisplay,i=this._textureData;if(this._displayIndex>=0&&this._display&&i){var r=i.parent;this._armature.replacedTexture&&this._displayData&&r===this._displayData.texture.parent&&(r=this._armature._replaceTextureAtlasData,r||(r=e.BaseObject.borrowObject(e.EgretTextureAtlasData),r.copyFrom(this._textureData.parent),r.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=r),i=r.getTexture(i.name));var a=r.texture?r.texture._bitmapData:null;if(a){if(!i.texture){var n=a.width,s=a.height,o=Math.min(i.region.width,n-i.region.x),l=Math.min(i.region.height,s-i.region.y);i.texture=new egret.Texture,i.texture._bitmapData=a,i.texture.$initData(i.region.x,i.region.y,o,l,0,0,o,l,n,s)}if(t){var h=this._renderDisplay,c=h.$renderNode;c.uvs.length=0,c.vertices.length=0,c.indices.length=0;for(var p=0,u=this._meshData.vertices.length;p<u;++p)c.uvs[p]=this._meshData.uvs[p],c.vertices[p]=this._meshData.vertices[p];for(var p=0,u=this._meshData.vertexIndices.length;p<u;++p)c.indices[p]=this._meshData.vertexIndices[p];h.$setBitmapData(i.texture),h.$setAnchorOffsetX(this._pivotX),h.$setAnchorOffsetY(this._pivotY),h.$updateVertices(),h.$invalidateTransform()}else{var d=this._renderDisplay;d.$setBitmapData(i.texture),d.$setAnchorOffsetX(this._pivotX),d.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}if(t){var h=this._renderDisplay;h.visible=!1,h.$setBitmapData(null),h.x=0,h.y=0}else{var d=this._renderDisplay;d.visible=!1,d.$setBitmapData(null),d.x=0,d.y=0}},i.prototype._updateMesh=function(){var e=this._renderDisplay,t=e.$renderNode,i=this._ffdVertices.length>0;if(this._meshData.skinned){for(var r=0,a=0,n=this._meshData.vertices.length;r<n;r+=2){for(var s=r/2,o=this._meshData.boneIndices[s],l=this._meshData.boneVertices[s],h=this._meshData.weights[s],c=0,p=0,u=0,d=o.length;u<d;++u){var f=this._meshBones[o[u]],_=f.globalTransformMatrix,g=h[u],m=0,y=0;i?(m=l[2*u]+this._ffdVertices[a],y=l[2*u+1]+this._ffdVertices[a+1]):(m=l[2*u],y=l[2*u+1]),c+=(_.a*m+_.c*y+_.tx)*g,p+=(_.b*m+_.d*y+_.ty)*g,a+=2}t.vertices[r]=c,t.vertices[r+1]=p}e.$updateVertices(),e.$invalidateTransform()}else if(i){for(var v=this._meshData.vertices,r=0,n=this._meshData.vertices.length;r<n;r+=2){var c=v[r]+this._ffdVertices[r],p=v[r+1]+this._ffdVertices[r+1];t.vertices[r]=c,t.vertices[r+1]=p}e.$updateVertices(),e.$invalidateTransform()}},i.prototype._updateTransform=function(e){if(e){var t=this._renderDisplay.matrix;t.identity(),this._renderDisplay.$setMatrix(t,this.transformUpdateEnabled)}else if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled),this._renderDisplay.$setAnchorOffsetX(this._pivotX),this._renderDisplay.$setAnchorOffsetX(this._pivotY);else{var i=this._renderDisplay.$DisplayObject,r=i[6];r.a=this.globalTransformMatrix.a,r.b=this.globalTransformMatrix.b,r.c=this.globalTransformMatrix.c,r.d=this.globalTransformMatrix.d,r.tx=this.globalTransformMatrix.tx,r.ty=this.globalTransformMatrix.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},i}(e.Slot);e.EgretSlot=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function i(r){void 0===r&&(r=null),t.call(this,r),i._eventManager||(i._eventManager=new e.EgretArmatureDisplay,i._clock=new e.WorldClock,i._clock.time=.001*egret.getTimer(),egret.startTick(i._clockHandler,i))}return __extends(i,t),i._clockHandler=function(e){e*=.001;var t=e-i._clock.time;return i._clock.advanceTime(t),i._clock.time=e,!1},Object.defineProperty(i,"factory",{get:function(){return i._factory||(i._factory=new i),i._factory},enumerable:!0,configurable:!0}),i.prototype._generateTextureAtlasData=function(t,i){return t?t.texture=i:t=e.BaseObject.borrowObject(e.EgretTextureAtlasData),t},i.prototype._generateArmature=function(t){var r=e.BaseObject.borrowObject(e.Armature),a=new e.EgretArmatureDisplay;return a._armature=r,r._init(t.armature,t.skin,a,a,i._eventManager),r},i.prototype._generateSlot=function(t,i,r){var a=i.slot,n=e.BaseObject.borrowObject(e.EgretSlot),s=[];n._init(i,new egret.Bitmap,new egret.Mesh);for(var o=0,l=i.displays.length;o<l;++o){var h=i.displays[o];switch(h.type){case 0:h.texture&&!t.textureAtlasName||(h.texture=this._getTextureData(t.textureAtlasName||t.dataName,h.path)),s.push(n.rawDisplay);break;case 2:h.texture&&!t.textureAtlasName||(h.texture=this._getTextureData(t.textureAtlasName||t.dataName,h.path)),!h.mesh&&h.share&&(h.mesh=i.getMesh(h.share)),"webgl"===egret.Capabilities.renderMode||egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE?s.push(n.meshDisplay):(console.warn("Canvas can not support mesh, please change renderMode to webgl."),s.push(n.rawDisplay));break;case 1:var c=this.buildArmature(h.path,t.dataName,null,t.textureAtlasName);if(c){if(c.inheritAnimation=h.inheritAnimation,!c.inheritAnimation){var p=a.actions.length>0?a.actions:c.armatureData.actions;if(p.length>0)for(var u=0,d=p.length;u<d;++u)c._bufferAction(p[u]);else c.animation.play()}h.armature=c.armatureData}s.push(c);break;default:s.push(null)}}return n._setDisplayList(s),n},i.prototype.buildArmatureDisplay=function(e,t,r,a){void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null);var n=this.buildArmature(e,t,r,a);return n?(i._clock.add(n),n.display):null},i.prototype.getTextureDisplay=function(e,t){void 0===t&&(t=null);var i=this._getTextureData(t,e);if(i){if(!i.texture){var r=i.parent.texture;i.texture=new egret.Texture,i.texture._bitmapData=r._bitmapData,i.texture.$initData(i.region.x,i.region.y,i.region.width,i.region.height,0,0,i.region.width,i.region.height,r.textureWidth,r.textureHeight)}return new egret.Bitmap(i.texture)}return null},Object.defineProperty(i.prototype,"soundEventManager",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i.prototype.addSkeletonData=function(e,t){void 0===t&&(t=null),this.addDragonBonesData(e,t)},i.prototype.getSkeletonData=function(e){return this.getDragonBonesData(e)},i.prototype.removeSkeletonData=function(e){this.removeDragonBonesData(e)},i.prototype.addTextureAtlas=function(e,t){void 0===t&&(t=null),this.addTextureAtlasData(e,t)},i.prototype.getTextureAtlas=function(e){return this.getTextureAtlasData(e)},i.prototype.removeTextureAtlas=function(e){this.removeTextureAtlasData(e)},i.prototype.buildFastArmature=function(e,t,i){return void 0===t&&(t=null),void 0===i&&(i=null),this.buildArmature(e,t,i)},i.prototype.dispose=function(){this.clear()},Object.defineProperty(i.prototype,"soundEventManater",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i._factory=null,i._eventManager=null,i._clock=null,i}(e.BaseFactory);e.EgretFactory=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){function t(e,t){for(var i=0,r=e.length;i<r;++i){var a=e[i];if(a.name===t)return a}return null}function i(e){if(e.groupName){var i=u[e.groupName];if(i){var r=t(i.movie,e.movieName);if(r)return e.groupConfig=i,e.movieConfig=r,!0}}if(!e.groupName)for(var a in u){var i=u[a];if(!e.groupName){var r=t(i.movie,e.movieName);if(r)return e.groupName=a,e.groupConfig=i,e.movieConfig=r,!0}}return!1}function r(e){return null!=u[e]}function a(e,t,i){if(void 0===i&&(i=null),!e)throw new Error;var r=new egret.ByteArray(e);r.endian=egret.Endian.LITTLE_ENDIAN,r.position=8;var a=JSON.parse(r.readUTF());a.offset=r.position,a.arrayBuffer=e,a.textures=[];var n=a.offset%4;n&&(a.offset+=4-n);for(var s=0,o=a.position.length;s<o;s+=3)switch(s/3){case 1:a.displayFrameArray=new Int16Array(a.arrayBuffer,a.offset+a.position[s],a.position[s+1]/a.position[s+2]);break;case 2:a.rectangleArray=new Float32Array(a.arrayBuffer,a.offset+a.position[s],a.position[s+1]/a.position[s+2]);break;case 3:a.transformArray=new Float32Array(a.arrayBuffer,a.offset+a.position[s],a.position[s+1]/a.position[s+2]);break;case 4:a.colorArray=new Int16Array(a.arrayBuffer,a.offset+a.position[s],a.position[s+1]/a.position[s+2])}if(i=i||a.name,u[i],u[i]=a,t instanceof Array)for(var s=0,o=t.length;s<o;++s){var l=t[s];a.textures.push(l)}else a.textures.push(t)}function n(e){var t=u[e];t&&delete u[e]}function s(){for(var e in u)delete u[e]}function o(e,t){void 0===t&&(t=null);var r={movieName:e,groupName:t};if(i(r)){var a=new f(r);return a}return console.warn("No movie named: "+e),null}function l(e){var t=u[e];if(t){for(var i=[],r=0,a=t.movie.length;r<a;++r)i.push(t.movie[r].name);return i}return console.warn("No group named: "+e),null}var h=function(e){function t(t){e.call(this),this.displayIndex=-1,this.colorIndex=-1,this.transformIndex=-1,this.config=null,this.displayConfig=null,this.display=null,this.childMovie=null,this.colorFilter=null,this.rawDisplay=new egret.Bitmap,this.childMovies={},this.display=this.rawDisplay,this.config=t,this.rawDisplay.name=this.config.name,null==this.config.blendMode&&(this.config.blendMode=0)}return __extends(t,e),t.prototype.dispose=function(){this.config=null,this.displayConfig=null,this.display=null,this.childMovie=null,this.colorFilter=null,this.rawDisplay=null,this.childMovies=null},t}(egret.HashObject),c=new egret.Rectangle,p=new egret.Matrix,u={};e.hasMovieGroup=r,e.addMovieGroup=a,e.removeMovieGroup=n,e.removeAllMovieGroup=s,e.buildMovie=o,e.getMovieNames=l;var d=function(e){function t(t){e.call(this,t),this.name=null,this.slotName=null,this.clipName=null,this.movie=null}return __extends(t,e),t.START="start",t.LOOP_COMPLETE="loopComplete",t.COMPLETE="complete",t.FRAME_EVENT="frameEvent",t.SOUND_EVENT="soundEvent",t}(egret.Event);e.MovieEvent=d;var f=function(t){function i(r){t.call(this),this.timeScale=1,this.clipTimeScale=1,this._batchEnabled=!0,this._isLockDispose=!1,this._isDelayDispose=!1,this._isStarted=!1,this._isPlaying=!1,this._isReversing=!1,this._isCompleted=!1,this._playTimes=0,this._time=0,this._currentTime=0,this._timeStamp=0,this._currentPlayTimes=0,this._cacheFrameIndex=0,this._frameSize=0,this._cacheRectangle=null,this._clock=null,this._groupConfig=null,this._config=null,this._clipConfig=null,this._currentFrameConfig=null,this._clipArray=null,this._clipNames=[],this._slots=[],this._childMovies=[],this._groupConfig=r.groupConfig,this._config=r.movieConfig,this._batchEnabled=!this._config.isNested,this._batchEnabled&&(this.$renderNode=new egret.sys.GroupNode,this.$renderNode.cleanBeforeRender=i._cleanBeforeRender),this._clipNames.length=0;for(var a=0,n=this._config.clip.length;a<n;++a)this._clipNames.push(this._config.clip[a].name);for(var a=0,n=this._config.slot.length;a<n;++a){var s=new h(this._config.slot[a]);this._updateSlotBlendMode(s),this._slots.push(s),this._batchEnabled?this.$renderNode.addNode(s.rawDisplay.$renderNode):this.addChild(s.rawDisplay)}this._frameSize=2*this._slots.length,e.EgretFactory.factory,this.advanceTimeBySelf(!0),this.name=this._config.name,this.play(),this.advanceTime(1e-6),this.stop()}return __extends(i,t),i._cleanBeforeRender=function(){},i.prototype._configToEvent=function(e,t){t.movie=this,t.clipName=this._clipConfig.name,t.name=e.name,t.slotName=e.slot},i.prototype._onCrossFrame=function(t){for(var i=0,r=t.actionAndEvent.length;i<r;++i){var a=t.actionAndEvent[i];if(a)switch(a.type){case 11:if(e.EgretFactory.factory.soundEventManater.hasEventListener(d.SOUND_EVENT)){var n=egret.Event.create(d,d.SOUND_EVENT);this._configToEvent(a,n),e.EgretFactory.factory.soundEventManater.dispatchEvent(n),egret.Event.release(n)}break;case 10:if(this.hasEventListener(d.FRAME_EVENT)){var s=egret.Event.create(d,d.FRAME_EVENT);this._configToEvent(a,s),this.dispatchEvent(s),egret.Event.release(s)}break;case 0:case 4:if(a.slot){var o=this._getSlot(a.slot);o&&o.childMovie&&o.childMovie.play(a.name)}else this.play(a.name)}}},i.prototype._updateSlotBlendMode=function(e){var t="";switch(e.config.blendMode){case 0:t=egret.BlendMode.NORMAL;break;case 1:t=egret.BlendMode.ADD;break;case 5:t=egret.BlendMode.ERASE}t&&(this._batchEnabled?e.display.$renderNode.blendMode=egret.sys.blendModeToNumber(t):e.display.blendMode=t)},i.prototype._updateSlotColor=function(e,t,i,r,a,n,s,o,l){if(1!==i||1!==r||1!==a||0!==s||0!==o||0!==l||0!==n){e.colorFilter||(e.colorFilter=new egret.ColorMatrixFilter);var h=e.colorFilter.matrix;if(h[0]=i,h[6]=r,h[12]=a,h[18]=t,h[4]=s,h[9]=o,h[14]=l,h[19]=n,e.colorFilter.matrix=h,this._batchEnabled){e.display.$renderNode.filter;e.display.$renderNode.filter=e.colorFilter}else{var c=e.display.filters;c||(c=[]),c.indexOf(e.colorFilter)<0&&c.push(e.colorFilter),e.display.filters=c}}else e.colorFilter&&(e.colorFilter=null),this._batchEnabled?(e.display.$renderNode.filter=null,e.display.$renderNode.alpha=t):(e.display.filters=null,e.display.$setAlpha(t))},i.prototype._updateSlotDisplay=function(e){var t=e.display||e.rawDisplay,i=e.childMovie;if(e.displayIndex>=0)if(e.displayConfig=this._groupConfig.display[e.displayIndex],1===e.displayConfig.type){var r=e.childMovies[e.displayConfig.name];r||(r=o(e.displayConfig.name,this._groupConfig.name),r.advanceTimeBySelf(!1),e.childMovies[e.displayConfig.name]=r),e.display=r,e.childMovie=r}else e.display=e.rawDisplay,e.childMovie=null;else e.displayConfig=null,e.display=e.rawDisplay,e.childMovie=null;if(e.display!==t&&(t&&(this.addChild(e.display),this.swapChildren(e.display,t),this.removeChild(t)),this._updateSlotBlendMode(e)),e.display===e.rawDisplay)if(e.displayConfig&&null!=e.displayConfig.regionIndex){if(!e.displayConfig.texture){var a=this._groupConfig.textures[0],n=4*e.displayConfig.regionIndex,s=this._groupConfig.rectangleArray[n],l=this._groupConfig.rectangleArray[n+1],h=this._groupConfig.rectangleArray[n+2],c=this._groupConfig.rectangleArray[n+3];e.displayConfig.texture=new egret.Texture,e.displayConfig.texture._bitmapData=a._bitmapData,e.displayConfig.texture.$initData(s,l,Math.min(h,a.textureWidth-s),Math.min(c,a.textureHeight-l),0,0,Math.min(h,a.textureWidth-s),Math.min(c,a.textureHeight-l),a.textureWidth,a.textureHeight)}if(this._batchEnabled){var p=e.displayConfig.texture,u=e.rawDisplay.$renderNode;egret.sys.RenderNode.prototype.cleanBeforeRender.call(e.rawDisplay.$renderNode),u.image=p._bitmapData,u.drawImage(p._bitmapX,p._bitmapY,p._bitmapWidth,p._bitmapHeight,p._offsetX,p._offsetY,p.textureWidth,p.textureHeight),u.imageWidth=p._sourceWidth,u.imageHeight=p._sourceHeight}else e.rawDisplay.visible=!0,e.rawDisplay.$setBitmapData(e.displayConfig.texture)}else this._batchEnabled?e.rawDisplay.$renderNode.image=null:(e.rawDisplay.visible=!1,e.rawDisplay.$setBitmapData(null));e.childMovie!==i&&(i&&(i.stop(),this._childMovies.slice(this._childMovies.indexOf(i),1)),e.childMovie&&(this._childMovies.indexOf(e.childMovie)<0&&this._childMovies.push(e.childMovie),e.config.action?e.childMovie.play(e.config.action):e.childMovie.play(e.childMovie._config.action)))},i.prototype._getSlot=function(e){for(var t=0,i=this._slots.length;t<i;++t){var r=this._slots[t];if(r.config.name===e)return r}return null},i.prototype.$render=function(){this._batchEnabled||t.prototype.$render.call(this)},i.prototype.$measureContentBounds=function(e){this._batchEnabled&&this._cacheRectangle?e.setTo(this._cacheRectangle.x,this._cacheRectangle.y,this._cacheRectangle.width-this._cacheRectangle.x,this._cacheRectangle.height-this._cacheRectangle.y):t.prototype.$measureContentBounds.call(this,e)},i.prototype.$doAddChild=function(e,i,r){return this._batchEnabled?(console.warn("Can not add child."),null):t.prototype.$doAddChild.call(this,e,i,r)},i.prototype.$doRemoveChild=function(e,i){return this._batchEnabled?(console.warn("Can not remove child."),null):t.prototype.$doRemoveChild.call(this,e,i)},i.prototype.dispose=function(){if(this._isLockDispose)this._isDelayDispose=!0;else{if(this._clock&&this._clock.remove(this),this._slots)for(var e=0,t=this._slots.length;e<t;++e)this._slots[e].dispose();this._isPlaying=!1,this._cacheRectangle=null,this._clock=null,this._groupConfig=null,this._config=null,this._clipConfig=null,this._currentFrameConfig=null,this._clipArray=null,this._clipNames=null,this._slots=null,this._childMovies=null}},i.prototype.advanceTime=function(e){if(this._isPlaying){this._isLockDispose=!0,e<0&&(e=-e),e*=this.timeScale,this._time+=e*this.clipTimeScale;var t=this._clipConfig.duration,i=t*this._playTimes,r=this._time,a=this._currentPlayTimes;if(this._playTimes>0&&(r>=i||r<=-i)?(this._isCompleted=!0,a=this._playTimes,r=r<0?0:t):(this._isCompleted=!1,r<0?(a=Math.floor(-r/t),r=t- -r%t):(a=Math.floor(r/t),r%=t),this._playTimes>0&&a>this._playTimes&&(a=this._playTimes)),this._currentTime!==r){var n=Math.floor(r*this._clipConfig.cacheTimeToFrameScale);if(this._cacheFrameIndex!==n){this._cacheFrameIndex=n;var s=this._groupConfig.displayFrameArray,o=this._groupConfig.transformArray,l=this._groupConfig.colorArray,h=!0,u=!1,f=!1,_=this._cacheRectangle;this._cacheRectangle=this._clipConfig.cacheRectangles[this._cacheFrameIndex],this._batchEnabled&&!this._cacheRectangle&&(f=!0,this._cacheRectangle=new egret.Rectangle,this._clipConfig.cacheRectangles[this._cacheFrameIndex]=this._cacheRectangle);for(var g=0,m=this._slots.length;g<m;++g){var y=this._slots[g],v=this._frameSize*this._cacheFrameIndex+2*g,b=2*this._clipArray[v];if(b>=0){var E=s[b],x=8*s[b+1],D=6*this._clipArray[v+1],T=!1;if(y.displayIndex!==E&&(y.displayIndex=E,T=!0,this._updateSlotDisplay(y)),(y.colorIndex!==x||T)&&(y.colorIndex=x,y.colorIndex>=0?this._updateSlotColor(y,.01*l[x],.01*l[x+1],.01*l[x+2],.01*l[x+3],l[x+4],l[x+5],l[x+6],l[x+7]):this._updateSlotColor(y,1,1,1,1,0,0,0,0)),u=!0,y.transformIndex!==D)if(y.transformIndex=D,this._batchEnabled){var C=y.display.$renderNode.matrix;C||(C=y.display.$renderNode.matrix=new egret.Matrix),C.a=o[D],C.b=o[D+1],C.c=o[D+2],C.d=o[D+3],C.tx=o[D+4],C.ty=o[D+5]}else p.a=o[D],p.b=o[D+1],p.c=o[D+2],p.d=o[D+3],p.tx=o[D+4],p.ty=o[D+5],y.display.$setMatrix(p);if(this._batchEnabled&&f){var C=y.display.$renderNode.matrix;c.x=0,c.y=0,c.width=y.displayConfig.texture.textureWidth,c.height=y.displayConfig.texture.textureHeight,C.$transformBounds(c),h?(h=!1,this._cacheRectangle.x=c.x,this._cacheRectangle.width=c.x+c.width,this._cacheRectangle.y=c.y,this._cacheRectangle.height=c.y+c.height):(this._cacheRectangle.x=Math.min(this._cacheRectangle.x,c.x),this._cacheRectangle.width=Math.max(this._cacheRectangle.width,c.x+c.width),this._cacheRectangle.y=Math.min(this._cacheRectangle.y,c.y),this._cacheRectangle.height=Math.max(this._cacheRectangle.height,c.y+c.height))}}else y.displayIndex!==-1&&(y.displayIndex=-1,this._updateSlotDisplay(y))}this._cacheRectangle&&(u&&f&&h&&_&&(this._cacheRectangle.x=_.x,this._cacheRectangle.y=_.y,this._cacheRectangle.width=_.width,this._cacheRectangle.height=_.height),this.$invalidateContentBounds())}if(this._isCompleted&&(this._isPlaying=!1),!this._isStarted&&(this._isStarted=!0,this.hasEventListener(d.START))){var M=egret.Event.create(d,d.START);M.movie=this,M.clipName=this._clipConfig.name,M.name=null,M.slotName=null,this.dispatchEvent(M)}this._isReversing=this._currentTime>r&&this._currentPlayTimes===a;var O=this._clipConfig.frame?this._clipConfig.frame.length:0;if(O>0){var w=Math.floor(this._currentTime*this._config.frameRate),A=this._groupConfig.frame[this._clipConfig.frame[w]];if(this._currentFrameConfig!==A)if(O>1){var N=this._currentFrameConfig;if(this._currentFrameConfig=A,!N){var F=Math.floor(this._currentTime*this._config.frameRate);N=this._groupConfig.frame[this._clipConfig.frame[F]],this._isReversing||(this._currentTime<=N.position||this._currentPlayTimes!==a)&&(N=this._groupConfig.frame[N.prev])}if(this._isReversing)for(;N!==A;)this._onCrossFrame(N),N=this._groupConfig.frame[N.prev];else for(;N!==A;)N=this._groupConfig.frame[N.next],this._onCrossFrame(N)}else this._currentFrameConfig=A,this._currentFrameConfig&&this._onCrossFrame(this._currentFrameConfig)}this._currentTime=r;for(var g=0,m=this._childMovies.length;g<m;++g)this._childMovies[g].advanceTime(e);if(this._currentPlayTimes!==a){if(this._currentPlayTimes=a,this.hasEventListener(d.LOOP_COMPLETE)){var R=egret.Event.create(d,d.LOOP_COMPLETE);R.movie=this,R.clipName=this._clipConfig.name,R.name=null,R.slotName=null,this.dispatchEvent(R),egret.Event.release(R)}if(this._isCompleted&&this.hasEventListener(d.COMPLETE)){var B=egret.Event.create(d,d.COMPLETE);B.movie=this,B.clipName=this._clipConfig.name,B.name=null,B.slotName=null,this.dispatchEvent(B),egret.Event.release(B)}}this._isLockDispose=!1,this._isDelayDispose&&this.dispose()}}},i.prototype.play=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=-1),e){for(var i=null,r=0,a=this._config.clip.length;r<a;++r){var n=this._config.clip[r];n.name===e&&(i=n)}i?(this._clipConfig=i,this._clipArray=new Int16Array(this._groupConfig.arrayBuffer,this._groupConfig.offset+this._groupConfig.position[0]+this._clipConfig.p,this._clipConfig.s/this._groupConfig.position[2]),this._clipConfig.cacheRectangles||(this._clipConfig.cacheRectangles=[]),this._isPlaying=!0,this._isStarted=!1,this._isCompleted=!1,t<0||t!==t?this._playTimes=this._clipConfig.playTimes:this._playTimes=t,this._time=0,this._currentTime=0,this._currentPlayTimes=0,this._cacheFrameIndex=-1,this._currentFrameConfig=null,this._cacheRectangle=null,this.clipTimeScale=1/this._clipConfig.scale):console.warn("No clip in movie.",this._config.name,e)}else this._clipConfig?this._isPlaying||this._isCompleted?this.play(this._clipConfig.name,this._playTimes):this._isPlaying=!0:this._config.action&&this.play(this._config.action,t)},i.prototype.stop=function(){this._isPlaying=!1},i.prototype.gotoAndPlay=function(e,t,i){void 0===e&&(e=null),void 0===i&&(i=-1),t%=this._clipConfig.duration,t<0&&(t+=this._clipConfig.duration),this.play(e,i),this._time=t,this._currentTime=t},i.prototype.gotoAndStop=function(e,t){void 0===e&&(e=null),t%=this._clipConfig.duration,t<0&&(t+=this._clipConfig.duration),this.play(e,1),this._time=t,this._currentTime=t,this.advanceTime(.001),this.stop()},i.prototype.hasClip=function(e){for(var t=0,i=this._config.clip.length;t<i;++t){var r=this._config.clip[t];if(r.name===e)return!0}return!1},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isComplete",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._clipConfig?this._clipConfig.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playTimes",{get:function(){return this._playTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupName",{get:function(){return this._groupConfig.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipName",{get:function(){return this._clipConfig?this._clipConfig.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipNames",{get:function(){
return this._clipNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(e){if(this._clock!==e){var t=this._clock;this._clock=e,t&&t.remove(this),this._clock&&this._clock.add(this)}},enumerable:!0,configurable:!0}),i.prototype.advanceTimeBySelf=function(t){t?this.clock=e.EgretFactory._clock:this.clock=null},i}(egret.DisplayObjectContainer);e.Movie=f}(dragonBones||(dragonBones={}));