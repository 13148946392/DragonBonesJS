var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},dragonBones;!function(e){var t=function(t){function r(e,r,a,n){t.call(this,e,r,a,n)}return __extends(r,t),Object.defineProperty(r.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),r.START=e.EventObject.START,r.LOOP_COMPLETE=e.EventObject.LOOP_COMPLETE,r.COMPLETE=e.EventObject.COMPLETE,r.FADE_IN=e.EventObject.FADE_IN,r.FADE_IN_COMPLETE=e.EventObject.FADE_IN_COMPLETE,r.FADE_OUT=e.EventObject.FADE_OUT,r.FADE_OUT_COMPLETE=e.EventObject.FADE_OUT_COMPLETE,r.FRAME_EVENT=e.EventObject.FRAME_EVENT,r.SOUND_EVENT=e.EventObject.SOUND_EVENT,r.ANIMATION_FRAME_EVENT=e.EventObject.FRAME_EVENT,r.BONE_FRAME_EVENT=e.EventObject.FRAME_EVENT,r.MOVEMENT_FRAME_EVENT=e.EventObject.FRAME_EVENT,r}(egret.Event);e.EgretEvent=t;var r=function(r){function a(){r.call(this),a._clock||(a._clock=new e.WorldClock,a._clock.time=.001*egret.getTimer(),egret.startTick(a._clockHandler,a))}return __extends(a,r),a._clockHandler=function(e){e*=.001;var t=a.passTime>0?a.passTime:e-a._clock.time;return a._clock.advanceTime(t),a._clock.time=e,!1},a.prototype._onClear=function(){this.advanceTimeBySelf(!1),this._armature=null,this._debugDrawer=null},a.prototype._dispatchEvent=function(e){var r=egret.Event.create(t,e.type);r.data=e,this.dispatchEvent(r),egret.Event.release(r)},a.prototype._debugDraw=function(){this._debugDrawer||(this._debugDrawer=new egret.Shape),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var e=this._armature.getBones(),t=0,r=e.length;t<r;++t){var a=e[t],n=Math.max(a.length,5),i=a.globalTransformMatrix.tx,o=a.globalTransformMatrix.ty,s=i+a.globalTransformMatrix.a*n,l=o+a.globalTransformMatrix.b*n;this._debugDrawer.graphics.lineStyle(1,a.ik?16711680:65280,.5),this._debugDrawer.graphics.moveTo(i,o),this._debugDrawer.graphics.lineTo(s,l)}},a.prototype.hasEvent=function(e){return this.hasEventListener(e)},a.prototype.addEvent=function(e,t,r){this.addEventListener(e,t,r)},a.prototype.removeEvent=function(e,t,r){this.removeEventListener(e,t,r)},a.prototype.advanceTimeBySelf=function(e){e?a._clock.add(this._armature):a._clock.remove(this._armature)},a.prototype.dispose=function(){this._armature&&this._armature.dispose()},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a.passTime=0,a._clock=null,a}(egret.DisplayObjectContainer);e.EgretArmatureDisplay=r;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AnimationEvent=a;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.FrameEvent=n;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.SoundEvent=i;var o=function(t){function r(r,a,n){void 0===n&&(n=1),t.call(this),this._onClear(),this.texture=r,e.ObjectDataParser.getInstance().parseTextureAtlasData(a,this,n)}return __extends(r,t),r.toString=function(){return"[Class dragonBones.EgretTextureAtlas]"},r}(e.EgretTextureAtlasData);e.EgretTextureAtlas=o;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(o);e.EgretSheetAtlas=s;var l=function(){function t(){}return t.getInstance=function(){return e.EventObject._soundEventManager},t}();e.SoundEventManager=l;var u=function(){function e(){}return e}();e.AnimationCacheManager=u}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(r){void 0===r&&(r=null),t.call(this,r),e.EventObject._soundEventManager||(e.EventObject._soundEventManager=new e.EgretArmatureDisplay)}return __extends(r,t),r.prototype._generateTextureAtlasData=function(t,r){return t?t.texture=r:t=e.BaseObject.borrowObject(e.EgretTextureAtlasData),t},r.prototype._generateArmature=function(t){var r=e.BaseObject.borrowObject(e.Armature),a=new e.EgretArmatureDisplay;return r._armatureData=t.armature,r._skinData=t.skin,r._animation=e.BaseObject.borrowObject(e.Animation),r._display=a,a._armature=r,r._animation._armature=r,r.animation.animations=t.armature.animations,r},r.prototype._generateSlot=function(t,r){var a=e.BaseObject.borrowObject(e.EgretSlot),n=r.slot,i=[];a.name=n.name,a._rawDisplay=new egret.Bitmap;for(var o=0,s=r.displays.length;o<s;++o){var l=r.displays[o];switch(l.type){case 0:l.textureData||(l.textureData=this._getTextureData(t.dataName,l.name)),i.push(a._rawDisplay);break;case 2:l.textureData||(l.textureData=this._getTextureData(t.dataName,l.name)),"webgl"==egret.Capabilities.renderMode?(a._meshDisplay||(a._meshDisplay=new egret.Mesh),i.push(a._meshDisplay)):i.push(a._rawDisplay);break;case 1:var u=this.buildArmature(l.name,t.dataName);if(u)if(n.actions.length>0)for(var c=0,p=n.actions.length;c<p;++c)u._bufferAction(n.actions[c]);else u.animation.play();i.push(u);break;default:i.push(null)}}return a._setDisplayList(i),a},r.prototype.buildArmatureDisplay=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var a=this.buildArmature(e,t,r),n=a?a._display:null;return n&&n.advanceTimeBySelf(!0),n},r.prototype.getTextureDisplay=function(e,t){void 0===t&&(t=null);var r=this._getTextureData(t,e);return r?new egret.Bitmap(r.texture):null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return e.EventObject._soundEventManager},enumerable:!0,configurable:!0}),r.prototype.addSkeletonData=function(e,t){void 0===t&&(t=null),this.addDragonBonesData(e,t)},r.prototype.getSkeletonData=function(e){return this.getDragonBonesData(e)},r.prototype.removeSkeletonData=function(e){this.removeDragonBonesData(e)},r.prototype.addTextureAtlas=function(e,t){void 0===t&&(t=null),this.addTextureAtlasData(e,t)},r.prototype.getTextureAtlas=function(e){return this.getTextureAtlasData(e)},r.prototype.removeTextureAtlas=function(e){this.removeTextureAtlasData(e)},r.prototype.buildFastArmature=function(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.buildArmature(e,t,r)},r}(e.BaseFactory);e.EgretFactory=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(e){function t(){e.call(this)}return __extends(t,e),t.toString=function(){return"[Class dragonBones.EgretSlot]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},t.prototype._onUpdateDisplay=function(){this._rawDisplay||(this._rawDisplay=new egret.Bitmap),this._renderDisplay=this._display||this._rawDisplay},t.prototype._initDisplay=function(e){},t.prototype._addDisplay=function(){var e=this._armature._display;e.addChild(this._renderDisplay)},t.prototype._replaceDisplay=function(e){var t=this._armature._display,r=e;t.addChild(this._renderDisplay),t.swapChildren(this._renderDisplay,r),t.removeChild(r)},t.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},t.prototype._disposeDisplay=function(e){},t.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},t.prototype._updateBlendMode=function(){if(this._blendMode<t.BLEND_MODE_LIST.length){var e=t.BLEND_MODE_LIST[this._blendMode];e&&(this._renderDisplay.blendMode=e)}},t.prototype._updateColor=function(){if(1!=this._colorTransform.redMultiplier||1!=this._colorTransform.greenMultiplier||1!=this._colorTransform.blueMultiplier||0!=this._colorTransform.redOffset||0!=this._colorTransform.greenOffset||0!=this._colorTransform.blueOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var e=this._colorFilter.matrix;e[0]=this._colorTransform.redMultiplier,e[6]=this._colorTransform.greenMultiplier,e[12]=this._colorTransform.blueMultiplier,e[18]=this._colorTransform.alphaMultiplier,e[4]=this._colorTransform.redOffset,e[9]=this._colorTransform.greenOffset,e[14]=this._colorTransform.blueOffset,e[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=e;var t=this._renderDisplay.filters;t||(t=[]),t.indexOf(this._colorFilter)<0&&t.push(this._colorFilter),this._renderDisplay.filters=t}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},t.prototype._updateFilters=function(){},t.prototype._updateFrame=function(){var e=this._renderDisplay;if(this._display&&this._displayIndex>=0){var t=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,r=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,a=r||t,n=a.textureData;if(n){var i=n.parent.texture;!n.texture&&i&&(n.texture=new egret.Texture,n.texture._bitmapData=i._bitmapData,n.texture.$initData(n.region.x,n.region.y,n.region.width,n.region.height,0,0,n.region.width,n.region.height,i.textureWidth,i.textureHeight));var o=this._armature._replacedTexture||n.texture;if(o){if(this._meshData&&this._display==this._meshDisplay){var s=this._meshDisplay,l=s.$renderNode;l.uvs.length=0,l.vertices.length=0,l.indices.length=0;for(var u=0,c=this._meshData.vertices.length;u<c;++u)l.uvs[u]=this._meshData.uvs[u],l.vertices[u]=this._meshData.vertices[u];for(var u=0,c=this._meshData.vertexIndices.length;u<c;++u)l.indices[u]=this._meshData.vertexIndices[u];if(s.$setBitmapData(o),s.$updateVertices(),s.$invalidateTransform(),this._meshData.skinned){var p=s.matrix;p.identity(),s.matrix=p}}else{var h=n.frame||n.region,d=h.width,_=h.height;n.rotated&&(d=h.height,_=h.width);var f=a.pivot.x,m=a.pivot.y;a.isRelativePivot&&(f=d*f,m=_*m),n.frame&&(f+=n.frame.x,m+=n.frame.y),t&&r&&(f+=t.transform.x-r.transform.x,m+=t.transform.y-r.transform.y),e.$setBitmapData(o),e.$setAnchorOffsetX(f),e.$setAnchorOffsetY(m)}return void this._updateVisible()}}}e.visible=!1,e.$setBitmapData(null),e.$setAnchorOffsetX(0),e.$setAnchorOffsetY(0),e.x=0,e.y=0},t.prototype._updateMesh=function(){var e=this._meshDisplay,t=e.$renderNode,r=this._ffdVertices.length>0;if(this._meshData.skinned){for(var a=0,n=0,i=this._meshData.vertices.length;a<i;a+=2){for(var o=a/2,s=this._meshData.boneIndices[o],l=this._meshData.boneVertices[o],u=this._meshData.weights[o],c=0,p=0,h=0,d=s.length;h<d;++h){var _=this._meshBones[s[h]],f=_.globalTransformMatrix,m=u[h],g=0,y=0;r?(g=l[2*h]+this._ffdVertices[n],y=l[2*h+1]+this._ffdVertices[n+1]):(g=l[2*h],y=l[2*h+1]),c+=(f.a*g+f.c*y+f.tx)*m,p+=(f.b*g+f.d*y+f.ty)*m,n+=2}t.vertices[a]=c,t.vertices[a+1]=p}e.$updateVertices(),e.$invalidateTransform()}else if(r){for(var v=this._meshData.vertices,a=0,i=this._meshData.vertices.length;a<i;a+=2){var c=v[a]+this._ffdVertices[a],p=v[a+1]+this._ffdVertices[a+1];t.vertices[a]=c,t.vertices[a+1]=p}e.$updateVertices(),e.$invalidateTransform()}},t.prototype._updateTransform=function(){this._renderDisplay.$setMatrix(this.globalTransformMatrix,this.transformUpdateEnabled)},t.BLEND_MODE_LIST=[egret.BlendMode.NORMAL,egret.BlendMode.ADD,null,null,null,egret.BlendMode.ERASE,null,null,null,null,null,null,null,null],t}(e.Slot);e.EgretSlot=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function a(){t.call(this)}return __extends(a,t),a.toString=function(){return"[Class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture=null)},a.prototype.generateTextureData=function(){return e.BaseObject.borrowObject(r)},a}(e.TextureAtlasData);e.EgretTextureAtlasData=t;var r=function(e){function t(){e.call(this)}return __extends(t,e),t.toString=function(){return"[Class dragonBones.EgretTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture.dispose(),this.texture=null)},t}(e.TextureData);e.EgretTextureData=r}(dragonBones||(dragonBones={}));